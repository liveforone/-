# 여러 요청을 어떻게 하나의 컨트롤러가 처리하나?

## 궁금하다..
* 이것이 참 궁금해 개발자 톡방에 질문글을 올린적이 있으나 가볍게 씹혔다.
* 내가 생각해도 바보 같은 질문같았다...ㅎ
* 그런데 이걸 이해하고 쓰는 사람 많을까??? 보통 그냥 그려녀니 하며 쓰지 않을까 싶다.
* 한 번 알아보자!

## 질문
* 내가 컨트롤러를 만들었을때 이 컨트롤러에 많은 request가 온다.
* Controller는 스프링 bean, 즉 싱글톤(오직 1개의 객체의 인스터스만 생성됨)이다.
* 근데 어떻게 이 수많은 요청을 처리하나???
* 또 하나의 컨트롤러가 많은 요청들의 값을 어떻게 정확하게 처리할까?(구분할까?)
* 병목현상 같은게 발생하지 않을까?

## 답
* 싱글톤으로 controller가 생성된다.
* controller 객체는 Heap 영역에 생성된다.
* controller 메소드나 명령은 메소드 영역에 생성된다.
* 여러 요청에 따라 쓰레드가 생성된다.
* 여러 쓰레드들이 controller에 접근해서 필요한 메소드를 사용만 하는것이다. 
* 즉 하나의 Controller를 쓰레드들이 공유하는것이다.
* 여기서 중요한 점은 메소드들은 상태가 없어야한다.
* 상태가 없기때문에 싱글톤 객체를 공유하는 장점이 존재할 수 있기 때문이다.
* 만약 상태를 갖게된다면 스레드들간의 동기화가 필요하고,
* 이에 따라 오버헤드가 발생하게 된다.

## 번외 - 톰캣의 요청 처리
1. 요청이 들어온 순서대로 Queue에 담는다.
2. ThreadPool에 현재 가용할 수 있는 Thread가 있는지 별도의 thread가 체크한다.
3. ThreadPool에 가용 Thread가 존재하면 Queue에서 요청을 꺼내어 Thread로 해당요청을 처리한다.
4. Thread는 각각 Stack 영역을 할당받는데 이 Stack 영역엔 다른 Thread가 접근할 수 없다.
5. 가용 Thread도 없고 Queue도 꽉 차있을때 요청이 들어오게 되면 RejectedExecutionException이 발생된다.
6. 여러 Thread들이 Controller의 메서드를 호출한 후 Thread를 ThreadPool에 반납한다.
7. 메소드가 호출되면 메소드 내부에 선언된 매개변수, 지역변수들이 Stack에 쌓이게 되며 해당 메소드가 종료되면 Stack에 쌓였던 변수들이 제거된다. 
