# 양방향 연관관계를 지양하라

## 양방향 연관관계란?
* 양방향 연관관계는 서로를 조회할 수 있는 관계이다.
* Jpa에서는 어노테이션 몇개로 쉽게 양방향 관계를 맺을 수 있다.
* 하지만 이 양방향 연관관계를 무분별하게, 또 아무 이유없이, 혹은 편리하다는 이유로 무자비하게 사용해서는 절대로 안된다.

## 양방향 연관관계의 문제점
* 첫째 : 순환참조를 발생시킬 수 있다.
* 복잡한 어플리케이션에서의 순환참조는.. 정말 찾기 어렵고 힘들어질 수 있다.
* 해결법이 있지만 순환참조를 발생시킬 여지를 가지고 있는 양방향은 삼가는 것이 좋다.
* 둘째 : 변경에 유연하지 않으며 어플리케이션을 복잡하게 만든다.
* 양방향으로 맺어진 관계의 객체들은 서로 영향을 주고 받는다.
* 이 경우 변경이 발생하게되면 양쪽을 모두 다 살피며 변경을 해야한다.
* 즉 유연하게 변경하기가 상당히 까다롭다.
* 따라서 변경시에 관리해야할 부분이 하나에서 두개로 늘어나게 된다.
* 항상 변경이나 확장 등에 반대쪽 관계까지 고려하며 변경해야한다.
* 이러한 문제는 시스템을 아주 복잡하게 만들며, 더욱 거대해지는 어플리케이션에서는 손을 쓸 수 없는 사태까지 만들게된다.

## 그렇다면 어떻게 양방향 관계를 대처할까?
* Board와 Comment를 예를 들때 일반적으로 어플리케이션을 두가지 방법으로 만들 수 있다.
* 첫째 : Board에 Comment가 같이 딸려있는 형태
* 둘째 : Board에서 Comment를 보려면 버튼을 클릭하여 Comment로 넘어가는 형태, 즉 분리된 형태
### 같이 붙어있는 형태일때
* Board 컨트롤러에서 CommentService를 호출하여 
* 해당 Board의 id를 외래키고 가지고 있는 Comment들을 List/Page의 형태로 가져온다.
* Map을 만들어서 Board와 Comments를 put 해주고 이를 클라이언트로 보내준다.
### 분리된 형태일때
* Board는 board만 클라이언트에게 전송하고
* 프론트단에서는 board의 id를 comment의 api에 넣어서 호출한다.
* Comment 컨트롤러에서 api를 받을 때에는 /comment/{boardId} 와 같은 형태로 api를 받아서 
* boardId를 외래키고 가지고 있는 Comments 들을 호출하여 클라이언트에게 보내준다.

## 결론
* 양방향 연관관계를 쓰지않고도 충분히 양방향 연관관계와 같은 효과를 가져온다.
* 코드 몇줄로 충분히 해결이 가능하다.
* 이런식의 코드들은 양방향이 가졌던 문제점을 전혀 가지지 않고 어플리케이션을 덜 복잡하게 만든다.
* 코드는 눈에 보이지만 db나 양방향 같은 단순 어노테이션 세팅은 눈에 잘 띄지 않는다.
* 눈에 띄는 코드로 작업하는것이 편리성이 떨어질지라도 
* 어플리케이션을 보다 안전하게 만들어주는 효과가 있으니 이를 잘 지키자.
