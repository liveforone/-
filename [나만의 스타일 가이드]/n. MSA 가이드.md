# MSA 가이드
* msa는 서비스간의 통신이 중요하고, 복잡하다.
* 이를 제대로 처리하지 않으면 코드가 스파게티처럼 꼬이게 된다.

## 1. 기본 식별자 위주의 쿼리
* msa에서는 cqrs패턴을 많이 적용한다.
* command를 하더라도, query를 날리더라도 기본 식별자를 만들어 사용하면 서비스들을 통합하여 관리하기 쉬워진다.
* 기본 식별자는 id가 될수도 있고, email이 될수도 있다.
* a서비스에서 b서비스가 데이터를 가져온다고 가정할때,
* a서비스에서는 id나 email등의 db 컬럼내의 값을 식별자로 정해서 이것을 가지고 통신하는 것이다.
* 물론 상황에 따라 꼭 식별자를 가지고 통신을 할 수 없으나,
* 식별자를 정하면 사용자로부터 입력을 통합하여 제한할 수 있고,
* 쿼리 재사용등 많은 장점이 있다. 
* 아래는 예시이다.
```
[User service]
id, email, name
기본 식별자 : email, email 바탕으로 api와 쿼리가 정의됨

[Bank service]
feign client - @("/bank-info/{email})
```

## 2. 외부 테이블 식별자
* 하나의 DB를 쓰느경우 fk를 놓고 조인하면되지만,
* 마이크로 서비스는 서비스 별로 DB를 구축했기 때문에
* 다른 DB와 연결해주기 위해서는 식별자가 필요하다.
* 이러한 식별자가 1대1로 매칭될 경우 반드시 unique 제약 조건을 걸어주어야한다.
* 아래 예시에서는 user_id가 바로 외부 테이블 식별자가 된다.
* FK처럼 선언하고 끝나는 것이 아니기에 제약조건을 상세하게 걸어주야한다.
* 단순 컬럼이라 생각 하면안된다. FK처럼 생각해서는 큰 코 다친다.
```
Bank Table
[id][bank_number][user_id]
```
